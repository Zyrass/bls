[build]
  command = npm install
  command = bundle install && bundle exec jekyll build"
  publish = "_site"

# ======================================================================================================
#                                                                                           MINIFY HTML
# ======================================================================================================
#  This plugin adds the ability to minify the HTML generated by your build.
#  "https://github.com/philhawksworth/netlify-plugin-minify-html#readme"
# ======================================================================================================
[[plugins]]
  package = "netlify-plugin-minify-html"

  # Specify which deploy contexts we'll minify HTML in.
  # Supports any Deploy Contexts available in Netlify.
  # https://docs.netlify.com/site-deploys/overview/#deploy-contexts
  [plugins.inputs]
    contexts = [
      'production',
      'branch-deploy',
      'deploy-preview'
    ]

  # Optionally, override the default options for the minification
  # https://github.com/kangax/html-minifier#options-quick-reference
  [plugins.inputs.minifierOptions]
    removeComments = false
    collapseInlineTagWhitespace = false

# ======================================================================================================
#                                                                                         JEKYLL CACHE
# ======================================================================================================
#  Speed up deploys by caching your previous build cache, so you only need to build changed files
#  (and any other cached assets).
#  "https://github.com/Mesomorphic/netlify-plugin-jekyll-cache#readme"
# ======================================================================================================
  [[plugins]]
  package = "netlify-plugin-jekyll-cache"

# ======================================================================================================
#                                                                                         HTML-VALIDATE
# ======================================================================================================
#  netlify-plugin-html-validate adds the ability to validate HTML generated by your Netlify build using
#  html-validate.
#  "https://github.com/oliverroick/netlify-plugin-html-validate#readme"
#  "https://html-validate.org/usage/index.html#configuration"     <-----------  Aide Ã  la configuration
# ======================================================================================================
  [[plugins]]
  package = "netlify-plugin-html-validate"

  [plugins.inputs]
    ext = "html"
    config = ".htmlvalidate.json"

# ======================================================================================================
#                                                                           CHECK IF SITE IS VULNERABLE
# ======================================================================================================
#  This plugin uses is-website-vulnerable to detect vulnerable JavaScript frameworks in your site.
#  "https://github.com/erezrokah/netlify-plugin-is-website-vulnerable#readme"
#  "https://github.com/lirantal/is-website-vulnerable"
# ======================================================================================================
[[plugins]]
package = "netlify-plugin-is-website-vulnerable"

# ======================================================================================================
#                                                                                           IMAGE-OPTIM
# ======================================================================================================
#  Optimize images as part of your Netlify build process. Optimizes PNG, JPEG, GIF and SVG file formats.
#  "https://github.com/chrisdwheatley/netlify-plugin-image-optim#netlify-plugin-image-optim"
# ======================================================================================================
[[plugins]]
package = "netlify-plugin-image-optim"

# ======================================================================================================
#                                                                                            CHECKLINKS
# ======================================================================================================
#  Checklinks helps you keep all your asset references correct and avoid embarrassing broken links to
#  your internal pages, or even to external pages you link out to.
#  "https://github.com/munter/netlify-plugin-checklinks#readme"
# ======================================================================================================
[[plugins]]
package = "netlify-plugin-checklinks"
  [plugins.inputs]
  # An array of glob patterns for pages on your site
  # Recursive traversal will start from these
  entryPoints = [
    "*.html",
  ]

   # Recurse through all the links and asset references on your page, starting
  # at the entrypoints
  recursive = true

  # Checklinks outputs TAP (https://testanything.org/tap-version-13-specification.html)
  # by default. Enabling pretty mode makes the output easier on the eyes.
  pretty = true

  # You can mark some check as skipped, which will block checklinks
  # from ever attempting to execute them.
  # skipPatterns is an array of strings you can match against failing reports
  skipPatterns = []

  # You can mark some check as todo, which will execute the check, but allow failures.
  # todoPatterns is an array of strings you can match against failing reports
  todoPatterns = []

  # Report on all broken links to external pages.
  # Enabling this will make your tests more brittle, since you can't control
  # external pages.
  checkExternal = false

  # Enable to check references to source maps, source map sources etc.
  # Many build tools don't emit working references, so this is disabled by default
  followSourceMaps = false

# ======================================================================================================
#                                                                                            LIGHTHOUSE
# ======================================================================================================
#  A Netlify plugin to generate a Lighthouse report for every deploy
#  "https://github.com/netlify/netlify-plugin-lighthouse#readme"
# ======================================================================================================
[[plugins]]
  package = "@netlify/plugin-lighthouse"

  # optional, deploy the lighthouse report to a path under your site
  [plugins.inputs.audits]
    output_path = "reports/lighthouse.html"

  [[plugins]]
  package = "@netlify/plugin-lighthouse"

  # Set minimum thresholds for each report area
  [plugins.inputs.thresholds]
    performance = 0.9

  # to audit a path other than /
  # route1 audit will use the top level thresholds
  [[plugins.inputs.audits]]
    path = "route1"

  # you can optionally specify an output_path per audit, relative to the path, where HTML report output will be saved
  output_path = "reports/route1.html"

  # to audit a specific absolute url
  [[plugins.inputs.audits]]
    url = "https://www.example.com"

  # you can specify thresholds per audit
  [plugins.inputs.audits.thresholds]
    performance = 0.8
